from notch_filter import notch_filtering
from featrures_extraction import Segmentation
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from scipy import signal

segment_length=1000
sampling_rate=400
overlap_percentage=0.66
Sacc=pd.read_csv("data/strada liscia/Accelerometer.csv")
Yacc=Sacc['Acceleration y (m/s^2)']


Yacc_segments=Segmentation(Yacc,segment_length,overlap_percentage)
freq=np.fft.fftfreq(1000,d=1/sampling_rate)
Yacc_filtered=notch_filtering(Yacc,segment_length,sampling_rate,overlap_percentage)

Yacc_FFT_segments=[]
Yacc_FFT_filtered_segments=[]
for i in range(0,len(Yacc_segments)):
    Yacc_segments[i]=Yacc_segments[i]-np.mean(Yacc_segments[i])
    Yacc_filtered[i]=Yacc_filtered[i]-np.mean(Yacc_filtered[i])
    Yacc_FFT_segments.append(np.fft.fft(Yacc_segments[i]))
    Yacc_FFT_filtered_segments.append(np.fft.fft(Yacc_filtered[i]))


f0=70
w0=69#f0/(0.5*sampling_rate)
Q=w0/15
b,a=signal.iirnotch(w0,Q,sampling_rate)
filtered=signal.filtfilt(b,a,Yacc_segments[28])
filtered=filtered-np.mean(filtered)
fft_28=np.fft.fft(filtered)

plt.figure(figsize=(10,6))

plt.subplot(2,1,1)
plt.plot(freq,np.abs(Yacc_FFT_segments[28]))
plt.title("FFT raw segments")
plt.xlabel('Frequency (Hz)')
plt.ylabel('Amplitude (m/s^2)')
plt.xlim(0, sampling_rate / 2)  
plt.tight_layout()

plt.subplot(2,1,2)
plt.plot(freq,np.abs(fft_28))
plt.title("FFT filtered segments")
plt.xlabel('Frequency (Hz)')
plt.ylabel('Amplitude (m/s^2)')
plt.xlim(0, sampling_rate / 2)  
plt.tight_layout()
plt.show()
